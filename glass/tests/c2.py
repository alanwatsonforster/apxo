from apxo.tests.infrastructure import *

startfile(__file__, "flamed-out engines")

# Power with Flamed-Out Engines.

starttestsetup(verbose=False)
A1 = setupaircraft("A1", "AF", "F-80C", "A2-1330", "N", 10, 4.0, "CL")
A2 = setupaircraft("A2", "AF", "F-80C", "A2-1530", "N", 10, 4.0, "CL")
A3 = setupaircraft("A3", "AF", "F7U-3", "A2-1730", "N", 10, 4.0, "CL")
A4 = setupaircraft("A4", "AF", "F7U-3", "A2-1930", "N", 10, 4.0, "CL")
A5 = setupaircraft("A5", "AF", "F7U-3", "A2-2130", "N", 10, 4.0, "CL")
endtestsetup()

startgameturn()
A1.move("LVL", "M", "H,H,H,H")
A1._assert("A2-1326       N    10", 4.0)
A2.move("LVL", "M", "H,H,H,H", flamedoutengines=1)
A2._assert("A2-1526       N    10", 4.0)
A3.move("LVL", "AB", "H,H,H,H")
A3._assert("A2-1726       N    10", 4.0)
A4.move("LVL", "AB", "H,H,H,H", flamedoutengines=1)
A4._assert("A2-1926       N    10", 4.0)
A5.move("LVL", "AB", "H,H,H,H", flamedoutengines=2)
A5._assert("A2-2126       N    10", 4.0)
endgameturn()

startgameturn()
A1.move("LVL", "M", "H,H,H,H")
A1._assert("A2-1322       N    10", 4.5)
A2.move("LVL", "M", "H,H,H,H", flamedoutengines=1)
A2._assert("A2-1522       N    10", 3.5)
A3.move("LVL", "AB", "H,H,H,H")
A3._assert("A2-1722       N    10", 4.5)
A4.move("LVL", "AB", "H,H,H,H", flamedoutengines=1)
A4._assert("A2-1922       N    10", 4.0)
A5.move("LVL", "AB", "H,H,H,H", flamedoutengines=2)
A5._assert("A2-2122       N    10", 3.5)
endgameturn()

startgameturn()
A1.move("LVL", "M", "H,H,H,H")
A1._assert("A2-1318       N    10", 4.5)
A2.move("LVL", "M", "H,H,H", flamedoutengines=1)
A2._assert("A2-1519       N    10", 3.5)
A3.move("LVL", "AB", "H,H,H,H")
A3._assert("A2-1718       N    10", 5.0)
A4.move("LVL", "AB", "H,H,H,H", flamedoutengines=1)
A4._assert("A2-1918       N    10", 4.5)
A5.move("LVL", "AB", "H,H,H", flamedoutengines=2)
A5._assert("A2-2119       N    10", 3.5)
endgameturn()

startgameturn()
A1.move("LVL", "M", "H,H,H,H,H")
A1._assert("A1-1313       N    10", 5.0)
A2.move("LVL", "M", "H,H,H,H", flamedoutengines=1)
A2._assert("A1-1515       N    10", 3.0)
A3.move("LVL", "AB", "H,H,H,H,H")
A3._assert("A1-1713       N    10", 5.5)
A4.move("LVL", "AB", "H,H,H,H", flamedoutengines=1)
A4._assert("A1-1914       N    10", 4.5)
A5.move("LVL", "AB", "H,H,H,H", flamedoutengines=2)
A5._assert("A1-2115       N    10", 3.0)
endgameturn()

# Flame-Out Warnings

# We don't automatically check that the warnings are issued, but if the code is run with verbose=True they should apxo.pear.

starttestsetup(sheets=[["A1"], ["A2"]])
A1 = setupaircraft("A1", "AF", "F-80C", "A2-1330", "N", 45, 4.0, "CL")
A2 = setupaircraft("A2", "AF", "F-80C", "A2-1530", "N", 10, 4.0, "CL")
A3 = setupaircraft("A3", "AF", "F7U-3", "A2-1730", "N", 10, 4.0, "CL")
endtestsetup()

startgameturn()
A1.move("ZC", "M", "H,H,H,C")
A1._assert("A2-1327       N    46", 4.0)
A2.move("DP", "M", "R180")
A2._assert("A2-1530       S     6", 4.0)
A3.move("LVL", "I", "H,H,H,H")
A3._assert("A2-1726       N    10", 4.0)
endgameturn()

startgameturn()
A1.move("ZC", "M", "H,H,H,C")
A1._assert("A2-1324       N    47", 4.0)
A2.move("DP", "M", "R180")
A2._assert("A2-1530       N     0", 4.0)
A3.move("LVL", "AB", "H,H,H,H")
A3._assert("A2-1722       N    10", 4.0)
endgameturn()

endfile(__file__)
